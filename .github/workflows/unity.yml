name: Unity-Tests

on: [push]

jobs:
#  testRunnerInEditMode:
#    name: EditMode Tests
#    runs-on: ubuntu-latest
#    env:
#      UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}   
#    steps:
#      - name: Checkout repository
#        uses: actions/checkout@v2
#
#      - name: Activate license
#        uses: MirrorNG/unity-runner@3.1.0
#        with:
#          entrypoint: /activate.sh
#
#      - name: Run tests
#        uses: MirrorNG/unity-runner@3.1.0
#        id: editModeTests
#        with:
#          args: -runTests -projectPath ./RePacker.Unity.Tests/ -testPlatform EditMode -testResults results.xml
#
#      - name: Expose as artifact
#        uses: actions/upload-artifact@v2
#        with:
#            name: EditMode Test Results
#            path: results.xml
  testRunnerInPlayMode:
    name: PlayMode Tests
    runs-on: windows-latest
    env:
      UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}   
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Add msbuild to PATH
        uses: microsoft/setup-msbuild@v1.0.2

      - name: Setup NuGet
        uses: NuGet/setup-nuget@v1.0.5
      - name: nuget restore
        run: nuget restore "./RePacker.Unity/RePacker.Unity.csproj"
        
      - name: Build RePacker
        run: msbuild "./RePacker.Unity/RePacker.Unity.csproj" /p:configuration=Unity;TargetFrameworkVersion=net4.6.1
      - name: Move RePacker DLLs
        run: |
          mv ./RePacker.Unity/bin/Unity/net4.6.1/RePacker.dll ./RePacker.Unity.Tests/Assets/RePacker/RePacker.dll
          mv ./RePacker.Unity/bin/Unity/net4.6.1/RePacker.Unsafe.dll ./RePacker.Unity.Tests/Assets/RePacker/RePacker.Unsafe.dll
          mv ./RePacker.Unity/bin/Unity/net4.6.1/RePacker.Unity.dll ./RePacker.Unity.Tests/Assets/RePacker/RePacker.Unity.dll

      - name: Activate license
        uses: MirrorNG/unity-runner@3.1.0
        with:
          entrypoint: /activate.sh

      - name: Run tests
        uses: MirrorNG/unity-runner@3.1.0
        id: playModeTests
        with:
          args: -runTests -projectPath ./RePacker.Unity.Tests/ -testPlatform PlayMode -testResults results.xml

      - name: Expose as artifact
        uses: actions/upload-artifact@v2
        with:
            name: PlayMode Test Results
            path: results.xml