<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Refsa\Documents\repackage\csharp\RePacker\Utils\ReflectionUtils.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;
using System.Security;

namespace RePacker.Utils
{
    public static class ReflectionUtils
    {
        public static IEnumerable&lt;Type&gt; GetAllTypes()
        {
#if NET461 || NET471 || NET48
            List&lt;Type&gt; types = new List&lt;Type&gt;();

            foreach (var asm in AppDomain.CurrentDomain.GetAssemblies())
            {
                try
                {
                    var asmTypes = asm.GetTypes();
                    types.AddRange(asmTypes);
                }
                catch (Exception e)
                {
                    RePacking.Logger.Exception(e);
                }
            }

            return types;
#else
            return AppDomain.CurrentDomain
                .GetAssemblies()
                .SelectMany(e =&gt; e.GetTypes());
#endif
        }

        public static IEnumerable&lt;Type&gt; WithAttribute(this IEnumerable&lt;Type&gt; self, Type attributeType)
        {
            return self.Where(t =&gt;
                Attribute.GetCustomAttribute(t, attributeType) != null
            );
        }

        public static IEnumerable&lt;PropertyInfo&gt; WithAttribute(this IEnumerable&lt;PropertyInfo&gt; self, Type attributeType)
        {
            return self.Where(t =&gt;
                Attribute.GetCustomAttribute(t, attributeType) != null
            );
        }

        public static IEnumerable&lt;Type&gt; WithGenericBaseType(this IEnumerable&lt;Type&gt; self, Type genericBaseType)
        {
            return
                self.Where(t =&gt;
                    t.BaseType != null &amp;&amp;
                    t.BaseType.IsGenericType &amp;&amp;
                    t.BaseType.GetGenericTypeDefinition() == genericBaseType
                );
        }

        public static IEnumerable&lt;Type&gt; NotGeneric(this IEnumerable&lt;Type&gt; self)
        {
            return self.Where(t =&gt; !t.IsGenericType);
        }

        public static bool HasGetterAndSetter(this PropertyInfo target)
        {
            return target.GetMethod != null &amp;&amp; target.SetMethod != null;
        }

        public static FieldInfo GetPropertyBackingFieldInfo(Type target, string propertyName)
        {
            string backingFieldName = $&quot;&lt;{propertyName}&gt;k__BackingField&quot;;
            FieldInfo fi = target.GetField(backingFieldName, BindingFlags.Instance | BindingFlags.NonPublic);
            return fi;
        }

        public static IEnumerable&lt;FieldInfo&gt; GetAllFields(Type target)
        {
            var directFields = target.GetFields(BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic);
            var propBackingFields = target
                .GetProperties(BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic)
                .Select(e =&gt; GetPropertyBackingFieldInfo(target, e.Name))
                .Where(fi =&gt; fi != null);

            return directFields.Concat(propBackingFields).Distinct();
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[12,9,12,10,1],[12,9,12,10,1],[12,9,12,10,1],[12,9,12,10,1],[12,9,12,10,1],[14,13,14,49,1],[14,13,14,49,1],[14,13,14,49,1],[16,13,16,20,1],[16,13,16,20,1],[16,13,16,20,1],[16,22,16,29,1],[16,22,16,29,1],[16,22,16,29,1],[16,30,16,32,1],[16,30,16,32,1],[16,30,16,32,1],[16,33,16,72,1],[16,33,16,72,1],[16,33,16,72,1],[17,13,17,14,1],[17,13,17,14,1],[17,13,17,14,1],[19,17,19,18,1],[19,17,19,18,1],[19,17,19,18,1],[20,21,20,51,1],[20,21,20,51,1],[20,21,20,51,1],[21,21,21,46,1],[21,21,21,46,1],[21,21,21,46,1],[22,17,22,18,1],[22,17,22,18,1],[22,17,22,18,1],[23,17,23,36,1],[23,17,23,36,1],[23,17,23,36,1],[24,17,24,18,1],[24,17,24,18,1],[24,17,24,18,1],[25,21,25,51,1],[25,21,25,51,1],[25,21,25,51,1],[26,17,26,18,1],[26,17,26,18,1],[26,17,26,18,1],[27,13,27,14,1],[27,13,27,14,1],[27,13,27,14,1],[29,13,29,26,1],[29,13,29,26,1],[29,13,29,26,1],[31,13,33,34,1],[33,34,33,46,1],[33,46,33,48,1],[31,13,33,48,1],[31,13,33,34,1],[33,34,33,46,1],[33,46,33,48,1],[31,13,33,48,1],[35,9,35,10,1],[35,9,35,10,1],[35,9,35,10,1],[35,9,35,10,1],[35,9,35,10,1],[38,9,38,10,1],[38,9,38,10,1],[38,9,38,10,1],[38,9,38,10,1],[38,9,38,10,1],[39,13,40,17,1],[40,17,40,71,1],[40,71,41,15,1],[39,13,41,15,1],[39,13,40,17,1],[40,17,40,71,1],[40,71,41,15,1],[39,13,41,15,1],[39,13,40,17,1],[40,17,40,71,1],[40,71,41,15,1],[39,13,41,15,1],[39,13,40,17,1],[40,17,40,71,1],[40,71,41,15,1],[39,13,41,15,1],[39,13,40,17,1],[40,17,40,71,1],[40,71,41,15,1],[39,13,41,15,1],[42,9,42,10,1],[42,9,42,10,1],[42,9,42,10,1],[42,9,42,10,1],[42,9,42,10,1],[45,9,45,10,0],[45,9,45,10,0],[45,9,45,10,0],[45,9,45,10,0],[45,9,45,10,0],[46,13,47,17,0],[47,17,47,71,0],[47,71,48,15,0],[46,13,48,15,0],[46,13,47,17,0],[47,17,47,71,0],[47,71,48,15,0],[46,13,48,15,0],[46,13,47,17,0],[47,17,47,71,0],[47,71,48,15,0],[46,13,48,15,0],[46,13,47,17,0],[47,17,47,71,0],[47,71,48,15,0],[46,13,48,15,0],[46,13,47,17,0],[47,17,47,71,0],[47,71,48,15,0],[46,13,48,15,0],[49,9,49,10,0],[49,9,49,10,0],[49,9,49,10,0],[49,9,49,10,0],[49,9,49,10,0],[52,9,52,10,1],[52,9,52,10,1],[52,9,52,10,1],[52,9,52,10,1],[52,9,52,10,1],[53,13,55,21,1],[55,21,57,77,1],[57,77,58,19,1],[53,13,58,19,1],[53,13,55,21,1],[55,21,57,77,1],[57,77,58,19,1],[53,13,58,19,1],[53,13,55,21,1],[55,21,57,77,1],[57,77,58,19,1],[53,13,58,19,1],[53,13,55,21,1],[55,21,57,77,1],[57,77,58,19,1],[53,13,58,19,1],[53,13,55,21,1],[55,21,57,77,1],[57,77,58,19,1],[53,13,58,19,1],[59,9,59,10,1],[59,9,59,10,1],[59,9,59,10,1],[59,9,59,10,1],[59,9,59,10,1],[62,9,62,10,1],[62,9,62,10,1],[62,9,62,10,1],[62,9,62,10,1],[62,9,62,10,1],[63,13,63,36,1],[63,36,63,52,1],[63,52,63,54,1],[63,13,63,54,1],[63,13,63,36,1],[63,36,63,52,1],[63,52,63,54,1],[63,13,63,54,1],[63,13,63,36,1],[63,36,63,52,1],[63,52,63,54,1],[63,13,63,54,1],[63,13,63,36,1],[63,36,63,52,1],[63,52,63,54,1],[63,13,63,54,1],[63,13,63,36,1],[63,36,63,52,1],[63,52,63,54,1],[63,13,63,54,1],[64,9,64,10,1],[64,9,64,10,1],[64,9,64,10,1],[64,9,64,10,1],[64,9,64,10,1],[67,9,67,10,0],[67,9,67,10,0],[67,9,67,10,0],[67,9,67,10,0],[67,9,67,10,0],[68,13,68,73,0],[68,13,68,73,0],[68,13,68,73,0],[68,13,68,73,0],[68,13,68,73,0],[69,9,69,10,0],[69,9,69,10,0],[69,9,69,10,0],[69,9,69,10,0],[69,9,69,10,0],[72,9,72,10,1],[72,9,72,10,1],[72,9,72,10,1],[72,9,72,10,1],[72,9,72,10,1],[73,13,73,74,1],[73,13,73,74,1],[73,13,73,74,1],[73,13,73,74,1],[73,13,73,74,1],[74,13,74,110,1],[74,13,74,110,1],[74,13,74,110,1],[74,13,74,110,1],[74,13,74,110,1],[75,13,75,23,1],[75,13,75,23,1],[75,13,75,23,1],[75,13,75,23,1],[75,13,75,23,1],[76,9,76,10,1],[76,9,76,10,1],[76,9,76,10,1],[76,9,76,10,1],[76,9,76,10,1],[79,9,79,10,1],[79,9,79,10,1],[79,9,79,10,1],[79,9,79,10,1],[79,9,79,10,1],[80,13,80,119,1],[80,13,80,119,1],[80,13,80,119,1],[80,13,80,119,1],[80,13,80,119,1],[81,13,83,30,1],[83,30,83,73,1],[83,73,84,30,1],[84,30,84,40,1],[84,40,84,42,1],[81,13,84,42,1],[81,13,83,30,1],[83,30,83,73,1],[83,73,84,30,1],[84,30,84,40,1],[84,40,84,42,1],[81,13,84,42,1],[81,13,83,30,1],[83,30,83,73,1],[83,73,84,30,1],[84,30,84,40,1],[84,40,84,42,1],[81,13,84,42,1],[81,13,83,30,1],[83,30,83,73,1],[83,73,84,30,1],[84,30,84,40,1],[84,40,84,42,1],[81,13,84,42,1],[81,13,83,30,1],[83,30,83,73,1],[83,73,84,30,1],[84,30,84,40,1],[84,40,84,42,1],[81,13,84,42,1],[86,13,86,70,1],[86,13,86,70,1],[86,13,86,70,1],[86,13,86,70,1],[86,13,86,70,1],[87,9,87,10,1],[87,9,87,10,1],[87,9,87,10,1],[87,9,87,10,1],[87,9,87,10,1]]);
    </script>
  </body>
</html>