<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Refsa\Documents\repackage\csharp\RePacker\Generator\GeneratorLookup.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;

namespace RePacker.Builder
{
    internal static class GeneratorLookup
    {
        static readonly Dictionary&lt;GeneratorType, Dictionary&lt;Type, IGenerator&gt;&gt; generators;

        static GeneratorLookup()
        {
            try
            {
                generators =
                new Dictionary&lt;GeneratorType, Dictionary&lt;Type, IGenerator&gt;&gt;
                {
                {GeneratorType.None, new Dictionary&lt;Type, IGenerator&gt;{}},
                {GeneratorType.Unmanaged, new Dictionary&lt;Type, IGenerator&gt;{
                    {Type.Missing.GetType(), new UnmanagedGenerator()}
                }},
                {GeneratorType.Struct, new Dictionary&lt;Type, IGenerator&gt;{
                    {Type.Missing.GetType(), new UnmanagedStructGenerator()}
                }},
                {GeneratorType.String, new Dictionary&lt;Type, IGenerator&gt;{
                    {Type.Missing.GetType(), new StringGenerator()},
                    {typeof(string), new StringGenerator()}
                }},
                {GeneratorType.Object, new Dictionary&lt;Type, IGenerator&gt;() {
                    {typeof(Array), new ArrayGenerator()},
                    {typeof(IList&lt;&gt;), new IListGenerator()},
                    {typeof(IEnumerable&lt;&gt;), new IEnumerableGenerator()},
                    {typeof(Dictionary&lt;,&gt;), new DictionaryGenerator()},
                    {typeof(List&lt;&gt;), new IListGenerator()},
                    {typeof(HashSet&lt;&gt;), new HashSetGenerator()},
                    {typeof(Queue&lt;&gt;), new QueueGenerator()},
                    {typeof(Stack&lt;&gt;), new StackGenerator()},

                    {typeof(KeyValuePair&lt;,&gt;), new KeyValuePairGenerator()},

                    {typeof(Nullable&lt;&gt;), new NullableGenerator()},

#if NET461
                    {typeof(ValueTuple&lt;,&gt;), new ValueTupleGenerator()},
                    {typeof(ValueTuple&lt;,,&gt;), new ValueTupleGenerator()},
                    {typeof(ValueTuple&lt;,,,&gt;), new ValueTupleGenerator()},
                    {typeof(ValueTuple&lt;,,,,&gt;), new ValueTupleGenerator()},
                    {typeof(ValueTuple&lt;,,,,,&gt;), new ValueTupleGenerator()},
                    {typeof(ValueTuple&lt;,,,,,,&gt;), new ValueTupleGenerator()},
                    {typeof(ValueTuple&lt;,,,,,,,&gt;), new ValueTupleGenerator()},
#else
                    {typeof(ITuple), new ValueTupleGenerator()},    
#endif
                }},
                {GeneratorType.RePacker, new Dictionary&lt;Type, IGenerator&gt;() {
                    {Type.Missing.GetType(), new RePackerGenerator()}
                }},
                {GeneratorType.DateTime, new Dictionary&lt;Type, IGenerator&gt;() {
                    {Type.Missing.GetType(), new DateTimeGenerator()}
                }}
                };
            }
            catch (Exception e)
            {
                RePacking.Logger.Exception(e);
            }
        }

        public static bool TryGet(GeneratorType generatorType, Type targetType, out IGenerator generator)
        {
            if (targetType == null)
            {
                targetType = Type.Missing.GetType();
            }

            if (generators == null)
            {
                generator = null;
                return false;
            }

            if (generators.TryGetValue(generatorType, out var _generator))
            {
                if (_generator.TryGetValue(targetType, out var dirGen))
                {
                    generator = dirGen;
                    return true;
                }
                else
                {
                    foreach (var intf in targetType.GetInterfaces())
                    {
                        if (_generator.TryGetValue(intf, out var intfGen))
                        {
                            generator = intfGen;
                            return true;
                        }
                    }
                }
            }

            generator = null;
            return false;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[12,9,12,10,1],[12,9,12,10,1],[12,9,12,10,1],[12,9,12,10,1],[12,9,12,10,1],[14,13,14,14,1],[14,13,14,14,1],[14,13,14,14,1],[14,13,14,14,1],[14,13,14,14,1],[15,17,61,19,1],[15,17,61,19,1],[15,17,61,19,1],[15,17,61,19,1],[15,17,61,19,1],[62,13,62,14,1],[62,13,62,14,1],[62,13,62,14,1],[62,13,62,14,1],[62,13,62,14,1],[63,13,63,32,0],[63,13,63,32,0],[63,13,63,32,0],[63,13,63,32,0],[63,13,63,32,0],[64,13,64,14,0],[64,13,64,14,0],[64,13,64,14,0],[64,13,64,14,0],[64,13,64,14,0],[65,17,65,47,0],[65,17,65,47,0],[65,17,65,47,0],[65,17,65,47,0],[65,17,65,47,0],[66,13,66,14,0],[66,13,66,14,0],[66,13,66,14,0],[66,13,66,14,0],[66,13,66,14,0],[67,9,67,10,1],[67,9,67,10,1],[67,9,67,10,1],[67,9,67,10,1],[67,9,67,10,1],[70,9,70,10,1],[70,9,70,10,1],[70,9,70,10,1],[70,9,70,10,1],[70,9,70,10,1],[71,13,71,36,1],[71,13,71,36,1],[71,13,71,36,1],[71,13,71,36,1],[71,13,71,36,1],[72,13,72,14,1],[72,13,72,14,1],[72,13,72,14,1],[72,13,72,14,1],[72,13,72,14,1],[73,17,73,53,1],[73,17,73,53,1],[73,17,73,53,1],[73,17,73,53,1],[73,17,73,53,1],[74,13,74,14,1],[74,13,74,14,1],[74,13,74,14,1],[74,13,74,14,1],[74,13,74,14,1],[76,13,76,36,1],[76,13,76,36,1],[76,13,76,36,1],[76,13,76,36,1],[76,13,76,36,1],[77,13,77,14,0],[77,13,77,14,0],[77,13,77,14,0],[77,13,77,14,0],[77,13,77,14,0],[78,17,78,34,0],[78,17,78,34,0],[78,17,78,34,0],[78,17,78,34,0],[78,17,78,34,0],[79,17,79,30,0],[79,17,79,30,0],[79,17,79,30,0],[79,17,79,30,0],[79,17,79,30,0],[82,13,82,75,1],[82,13,82,75,1],[82,13,82,75,1],[82,13,82,75,1],[82,13,82,75,1],[83,13,83,14,1],[83,13,83,14,1],[83,13,83,14,1],[83,13,83,14,1],[83,13,83,14,1],[84,17,84,72,1],[84,17,84,72,1],[84,17,84,72,1],[84,17,84,72,1],[84,17,84,72,1],[85,17,85,18,1],[85,17,85,18,1],[85,17,85,18,1],[85,17,85,18,1],[85,17,85,18,1],[86,21,86,40,1],[86,21,86,40,1],[86,21,86,40,1],[86,21,86,40,1],[86,21,86,40,1],[87,21,87,33,1],[87,21,87,33,1],[87,21,87,33,1],[87,21,87,33,1],[87,21,87,33,1],[90,17,90,18,0],[90,17,90,18,0],[90,17,90,18,0],[90,17,90,18,0],[90,17,90,18,0],[91,21,91,28,0],[91,21,91,28,0],[91,21,91,28,0],[91,21,91,28,0],[91,21,91,28,0],[91,30,91,38,0],[91,30,91,38,0],[91,30,91,38,0],[91,30,91,38,0],[91,30,91,38,0],[91,39,91,41,0],[91,39,91,41,0],[91,39,91,41,0],[91,39,91,41,0],[91,39,91,41,0],[91,42,91,68,0],[91,42,91,68,0],[91,42,91,68,0],[91,42,91,68,0],[91,42,91,68,0],[92,21,92,22,0],[92,21,92,22,0],[92,21,92,22,0],[92,21,92,22,0],[92,21,92,22,0],[93,25,93,75,0],[93,25,93,75,0],[93,25,93,75,0],[93,25,93,75,0],[93,25,93,75,0],[94,25,94,26,0],[94,25,94,26,0],[94,25,94,26,0],[94,25,94,26,0],[94,25,94,26,0],[95,29,95,49,0],[95,29,95,49,0],[95,29,95,49,0],[95,29,95,49,0],[95,29,95,49,0],[96,29,96,41,0],[96,29,96,41,0],[96,29,96,41,0],[96,29,96,41,0],[96,29,96,41,0],[98,21,98,22,0],[98,21,98,22,0],[98,21,98,22,0],[98,21,98,22,0],[98,21,98,22,0],[99,17,99,18,0],[99,17,99,18,0],[99,17,99,18,0],[99,17,99,18,0],[99,17,99,18,0],[100,13,100,14,0],[100,13,100,14,0],[100,13,100,14,0],[100,13,100,14,0],[100,13,100,14,0],[102,13,102,30,0],[102,13,102,30,0],[102,13,102,30,0],[102,13,102,30,0],[102,13,102,30,0],[103,13,103,26,0],[103,13,103,26,0],[103,13,103,26,0],[103,13,103,26,0],[103,13,103,26,0],[104,9,104,10,1],[104,9,104,10,1],[104,9,104,10,1],[104,9,104,10,1],[104,9,104,10,1]]);
    </script>
  </body>
</html>