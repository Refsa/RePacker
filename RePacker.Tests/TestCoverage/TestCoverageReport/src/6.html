<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Refsa\Documents\repackage\csharp\RePacker.Tests\SerializerTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Xunit;
using RePacker.Buffers;
using System.Runtime.InteropServices;
using System;
using Buffer = RePacker.Buffers.Buffer;

namespace RePacker.Tests
{
    public class SerializerTests
    {
        Buffer CreateBuffer(int size = 1024)
        {
            return new Buffer(new byte[size], 0);
        }

        [Fact]
        public void can_encode_and_decode_string()
        {
            var buffer = CreateBuffer();
            string testString = &quot;This is a test string&quot;;

            buffer.PackString(ref testString);

            string fromBuf = buffer.UnpackString();

            Assert.Equal(testString, fromBuf);
        }

        [Fact]
        public void can_encode_and_decode_string_multiple()
        {
            var buffer = CreateBuffer(1 &lt;&lt; 16);
            string testString = &quot;This is a test string&quot;;

            for (int i = 0; i &lt; 10; i++)
            {
                buffer.PackString(ref testString);
            }

            for (int i = 0; i &lt; 10; i++)
            {
                string fromBuf = buffer.UnpackString();

                Assert.Equal(testString, fromBuf);
            }
        }

        public enum TestByteEnum : byte
        {
            Zero = 0,
            One = 1,
            Two = 2,
            Three = 3,
        }

        [Fact]
        public void can_encode_and_decode_byte_enum()
        {
            var buffer = CreateBuffer();
            TestByteEnum testEnum = TestByteEnum.One;

            buffer.PackEnum&lt;TestByteEnum&gt;(ref testEnum);

            Assert.Equal(sizeof(byte), buffer.WriteCursor());

            TestByteEnum fromBuf = buffer.UnpackEnum&lt;TestByteEnum&gt;();

            Assert.Equal(testEnum, fromBuf);
        }

        public enum TestULongEnum : ulong
        {
            Zero = 0,
            One = 1,
            Two = 2,
            Three = 3,
        }

        [Fact]
        public void can_encode_and_decode_ulong_enum()
        {
            var buffer = CreateBuffer();
            TestULongEnum testEnum = TestULongEnum.One;

            buffer.PackEnum&lt;TestULongEnum&gt;(ref testEnum);

            Assert.Equal(sizeof(ulong), buffer.WriteCursor());

            TestULongEnum fromBuf = buffer.UnpackEnum&lt;TestULongEnum&gt;();

            Assert.Equal(testEnum, fromBuf);
        }

        [Fact]
        public void can_encode_and_decode_byte_blittable_array()
        {
            var buffer = CreateBuffer();

            byte[] testArray = new byte[64];
            for (int i = 0; i &lt; 64; i++) testArray[i] = (byte)i;

            buffer.PackBlittableArray&lt;byte&gt;(testArray);
            Assert.Equal(64 + sizeof(ulong), buffer.WriteCursor());

            byte[] fromBuf = buffer.UnpackBlittableArray&lt;byte&gt;();

            for (int i = 0; i &lt; 64; i++)
            {
                Assert.Equal(testArray[i], fromBuf[i]);
            }
        }

        [Fact]
        public void can_encode_and_decode_int_blittable_array()
        {
            var buffer = CreateBuffer();

            int[] testArray = new int[32];
            for (int i = 0; i &lt; 32; i++) testArray[i] = (int)i;

            buffer.PackBlittableArray&lt;int&gt;(testArray);
            Assert.Equal(32 * sizeof(int) + sizeof(ulong), buffer.WriteCursor());

            int[] fromBuf = buffer.UnpackBlittableArray&lt;int&gt;();

            for (int i = 0; i &lt; 32; i++)
            {
                Assert.Equal(testArray[i], fromBuf[i]);
            }
        }

        [StructLayout(LayoutKind.Sequential, Pack = 1, CharSet = CharSet.Unicode)]
        struct TestBlitStruct
        {
            public int Int;
            public float Float;
        }

        [Fact]
        public void can_encode_and_decode_struct_blittable_array()
        {
            var buffer = CreateBuffer();

            TestBlitStruct[] testData = new TestBlitStruct[32];
            for (int i = 0; i &lt; 32; i++)
            {
                testData[i].Float = 1.337f * (float)i;
                testData[i].Int = i;
            }

            buffer.PackBlittableArray&lt;TestBlitStruct&gt;(testData);

            Assert.Equal(32 * Marshal.SizeOf&lt;TestBlitStruct&gt;() + sizeof(ulong), buffer.WriteCursor());

            TestBlitStruct[] fromBuf = buffer.UnpackBlittableArray&lt;TestBlitStruct&gt;();

            for (int i = 0; i &lt; 32; i++)
            {
                Assert.Equal(testData[i].Float, fromBuf[i].Float);
                Assert.Equal(testData[i].Int, fromBuf[i].Int);
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[12,9,12,10,1],[12,9,12,10,1],[12,9,12,10,1],[12,9,12,10,1],[12,9,12,10,1],[13,13,13,50,1],[13,13,13,50,1],[13,13,13,50,1],[13,13,13,50,1],[13,13,13,50,1],[14,9,14,10,1],[14,9,14,10,1],[14,9,14,10,1],[14,9,14,10,1],[14,9,14,10,1],[18,9,18,10,1],[18,9,18,10,1],[18,9,18,10,1],[18,9,18,10,1],[18,9,18,10,1],[19,13,19,41,1],[19,13,19,41,1],[19,13,19,41,1],[19,13,19,41,1],[19,13,19,41,1],[20,13,20,57,1],[20,13,20,57,1],[20,13,20,57,1],[20,13,20,57,1],[20,13,20,57,1],[22,13,22,47,1],[22,13,22,47,1],[22,13,22,47,1],[22,13,22,47,1],[22,13,22,47,1],[24,13,24,52,1],[24,13,24,52,1],[24,13,24,52,1],[24,13,24,52,1],[24,13,24,52,1],[26,13,26,47,1],[26,13,26,47,1],[26,13,26,47,1],[26,13,26,47,1],[26,13,26,47,1],[27,9,27,10,1],[27,9,27,10,1],[27,9,27,10,1],[27,9,27,10,1],[27,9,27,10,1],[31,9,31,10,1],[31,9,31,10,1],[31,9,31,10,1],[31,9,31,10,1],[31,9,31,10,1],[32,13,32,48,1],[32,13,32,48,1],[32,13,32,48,1],[32,13,32,48,1],[32,13,32,48,1],[33,13,33,57,1],[33,13,33,57,1],[33,13,33,57,1],[33,13,33,57,1],[33,13,33,57,1],[35,18,35,27,1],[35,18,35,27,1],[35,18,35,27,1],[35,18,35,27,1],[35,18,35,27,1],[35,29,35,35,1],[35,29,35,35,1],[35,29,35,35,1],[35,29,35,35,1],[35,29,35,35,1],[35,37,35,40,1],[35,37,35,40,1],[35,37,35,40,1],[35,37,35,40,1],[35,37,35,40,1],[36,13,36,14,1],[36,13,36,14,1],[36,13,36,14,1],[36,13,36,14,1],[36,13,36,14,1],[37,17,37,51,1],[37,17,37,51,1],[37,17,37,51,1],[37,17,37,51,1],[37,17,37,51,1],[38,13,38,14,1],[38,13,38,14,1],[38,13,38,14,1],[38,13,38,14,1],[38,13,38,14,1],[40,18,40,27,1],[40,18,40,27,1],[40,18,40,27,1],[40,18,40,27,1],[40,18,40,27,1],[40,29,40,35,1],[40,29,40,35,1],[40,29,40,35,1],[40,29,40,35,1],[40,29,40,35,1],[40,37,40,40,1],[40,37,40,40,1],[40,37,40,40,1],[40,37,40,40,1],[40,37,40,40,1],[41,13,41,14,1],[41,13,41,14,1],[41,13,41,14,1],[41,13,41,14,1],[41,13,41,14,1],[42,17,42,56,1],[42,17,42,56,1],[42,17,42,56,1],[42,17,42,56,1],[42,17,42,56,1],[44,17,44,51,1],[44,17,44,51,1],[44,17,44,51,1],[44,17,44,51,1],[44,17,44,51,1],[45,13,45,14,1],[45,13,45,14,1],[45,13,45,14,1],[45,13,45,14,1],[45,13,45,14,1],[46,9,46,10,1],[46,9,46,10,1],[46,9,46,10,1],[46,9,46,10,1],[46,9,46,10,1],[58,9,58,10,1],[58,9,58,10,1],[58,9,58,10,1],[58,9,58,10,1],[58,9,58,10,1],[59,13,59,41,1],[59,13,59,41,1],[59,13,59,41,1],[59,13,59,41,1],[59,13,59,41,1],[60,13,60,54,1],[60,13,60,54,1],[60,13,60,54,1],[60,13,60,54,1],[60,13,60,54,1],[62,13,62,57,1],[62,13,62,57,1],[62,13,62,57,1],[62,13,62,57,1],[62,13,62,57,1],[64,13,64,62,1],[64,13,64,62,1],[64,13,64,62,1],[64,13,64,62,1],[64,13,64,62,1],[66,13,66,70,1],[66,13,66,70,1],[66,13,66,70,1],[66,13,66,70,1],[66,13,66,70,1],[68,13,68,45,1],[68,13,68,45,1],[68,13,68,45,1],[68,13,68,45,1],[68,13,68,45,1],[69,9,69,10,1],[69,9,69,10,1],[69,9,69,10,1],[69,9,69,10,1],[69,9,69,10,1],[81,9,81,10,1],[81,9,81,10,1],[81,9,81,10,1],[81,9,81,10,1],[81,9,81,10,1],[82,13,82,41,1],[82,13,82,41,1],[82,13,82,41,1],[82,13,82,41,1],[82,13,82,41,1],[83,13,83,56,1],[83,13,83,56,1],[83,13,83,56,1],[83,13,83,56,1],[83,13,83,56,1],[85,13,85,58,1],[85,13,85,58,1],[85,13,85,58,1],[85,13,85,58,1],[85,13,85,58,1],[87,13,87,63,1],[87,13,87,63,1],[87,13,87,63,1],[87,13,87,63,1],[87,13,87,63,1],[89,13,89,72,1],[89,13,89,72,1],[89,13,89,72,1],[89,13,89,72,1],[89,13,89,72,1],[91,13,91,45,1],[91,13,91,45,1],[91,13,91,45,1],[91,13,91,45,1],[91,13,91,45,1],[92,9,92,10,1],[92,9,92,10,1],[92,9,92,10,1],[92,9,92,10,1],[92,9,92,10,1],[96,9,96,10,1],[96,9,96,10,1],[96,9,96,10,1],[96,9,96,10,1],[96,9,96,10,1],[97,13,97,41,1],[97,13,97,41,1],[97,13,97,41,1],[97,13,97,41,1],[97,13,97,41,1],[99,13,99,45,1],[99,13,99,45,1],[99,13,99,45,1],[99,13,99,45,1],[99,13,99,45,1],[100,18,100,27,1],[100,18,100,27,1],[100,18,100,27,1],[100,18,100,27,1],[100,18,100,27,1],[100,29,100,35,1],[100,29,100,35,1],[100,29,100,35,1],[100,29,100,35,1],[100,29,100,35,1],[100,37,100,40,1],[100,37,100,40,1],[100,37,100,40,1],[100,37,100,40,1],[100,37,100,40,1],[100,42,100,65,1],[100,42,100,65,1],[100,42,100,65,1],[100,42,100,65,1],[100,42,100,65,1],[102,13,102,56,1],[102,13,102,56,1],[102,13,102,56,1],[102,13,102,56,1],[102,13,102,56,1],[103,13,103,68,1],[103,13,103,68,1],[103,13,103,68,1],[103,13,103,68,1],[103,13,103,68,1],[105,13,105,66,1],[105,13,105,66,1],[105,13,105,66,1],[105,13,105,66,1],[105,13,105,66,1],[107,18,107,27,1],[107,18,107,27,1],[107,18,107,27,1],[107,18,107,27,1],[107,18,107,27,1],[107,29,107,35,1],[107,29,107,35,1],[107,29,107,35,1],[107,29,107,35,1],[107,29,107,35,1],[107,37,107,40,1],[107,37,107,40,1],[107,37,107,40,1],[107,37,107,40,1],[107,37,107,40,1],[108,13,108,14,1],[108,13,108,14,1],[108,13,108,14,1],[108,13,108,14,1],[108,13,108,14,1],[109,17,109,56,1],[109,17,109,56,1],[109,17,109,56,1],[109,17,109,56,1],[109,17,109,56,1],[110,13,110,14,1],[110,13,110,14,1],[110,13,110,14,1],[110,13,110,14,1],[110,13,110,14,1],[111,9,111,10,1],[111,9,111,10,1],[111,9,111,10,1],[111,9,111,10,1],[111,9,111,10,1],[115,9,115,10,1],[115,9,115,10,1],[115,9,115,10,1],[115,9,115,10,1],[115,9,115,10,1],[116,13,116,41,1],[116,13,116,41,1],[116,13,116,41,1],[116,13,116,41,1],[116,13,116,41,1],[118,13,118,43,1],[118,13,118,43,1],[118,13,118,43,1],[118,13,118,43,1],[118,13,118,43,1],[119,18,119,27,1],[119,18,119,27,1],[119,18,119,27,1],[119,18,119,27,1],[119,18,119,27,1],[119,29,119,35,1],[119,29,119,35,1],[119,29,119,35,1],[119,29,119,35,1],[119,29,119,35,1],[119,37,119,40,1],[119,37,119,40,1],[119,37,119,40,1],[119,37,119,40,1],[119,37,119,40,1],[119,42,119,64,1],[119,42,119,64,1],[119,42,119,64,1],[119,42,119,64,1],[119,42,119,64,1],[121,13,121,55,1],[121,13,121,55,1],[121,13,121,55,1],[121,13,121,55,1],[121,13,121,55,1],[122,13,122,82,1],[122,13,122,82,1],[122,13,122,82,1],[122,13,122,82,1],[122,13,122,82,1],[124,13,124,64,1],[124,13,124,64,1],[124,13,124,64,1],[124,13,124,64,1],[124,13,124,64,1],[126,18,126,27,1],[126,18,126,27,1],[126,18,126,27,1],[126,18,126,27,1],[126,18,126,27,1],[126,29,126,35,1],[126,29,126,35,1],[126,29,126,35,1],[126,29,126,35,1],[126,29,126,35,1],[126,37,126,40,1],[126,37,126,40,1],[126,37,126,40,1],[126,37,126,40,1],[126,37,126,40,1],[127,13,127,14,1],[127,13,127,14,1],[127,13,127,14,1],[127,13,127,14,1],[127,13,127,14,1],[128,17,128,56,1],[128,17,128,56,1],[128,17,128,56,1],[128,17,128,56,1],[128,17,128,56,1],[129,13,129,14,1],[129,13,129,14,1],[129,13,129,14,1],[129,13,129,14,1],[129,13,129,14,1],[130,9,130,10,1],[130,9,130,10,1],[130,9,130,10,1],[130,9,130,10,1],[130,9,130,10,1],[141,9,141,10,1],[141,9,141,10,1],[141,9,141,10,1],[141,9,141,10,1],[141,9,141,10,1],[142,13,142,41,1],[142,13,142,41,1],[142,13,142,41,1],[142,13,142,41,1],[142,13,142,41,1],[144,13,144,64,1],[144,13,144,64,1],[144,13,144,64,1],[144,13,144,64,1],[144,13,144,64,1],[145,18,145,27,1],[145,18,145,27,1],[145,18,145,27,1],[145,18,145,27,1],[145,18,145,27,1],[145,29,145,35,1],[145,29,145,35,1],[145,29,145,35,1],[145,29,145,35,1],[145,29,145,35,1],[145,37,145,40,1],[145,37,145,40,1],[145,37,145,40,1],[145,37,145,40,1],[145,37,145,40,1],[146,13,146,14,1],[146,13,146,14,1],[146,13,146,14,1],[146,13,146,14,1],[146,13,146,14,1],[147,17,147,55,1],[147,17,147,55,1],[147,17,147,55,1],[147,17,147,55,1],[147,17,147,55,1],[148,17,148,37,1],[148,17,148,37,1],[148,17,148,37,1],[148,17,148,37,1],[148,17,148,37,1],[149,13,149,14,1],[149,13,149,14,1],[149,13,149,14,1],[149,13,149,14,1],[149,13,149,14,1],[151,13,151,65,1],[151,13,151,65,1],[151,13,151,65,1],[151,13,151,65,1],[151,13,151,65,1],[153,13,153,103,1],[153,13,153,103,1],[153,13,153,103,1],[153,13,153,103,1],[153,13,153,103,1],[155,13,155,86,1],[155,13,155,86,1],[155,13,155,86,1],[155,13,155,86,1],[155,13,155,86,1],[157,18,157,27,1],[157,18,157,27,1],[157,18,157,27,1],[157,18,157,27,1],[157,18,157,27,1],[157,29,157,35,1],[157,29,157,35,1],[157,29,157,35,1],[157,29,157,35,1],[157,29,157,35,1],[157,37,157,40,1],[157,37,157,40,1],[157,37,157,40,1],[157,37,157,40,1],[157,37,157,40,1],[158,13,158,14,1],[158,13,158,14,1],[158,13,158,14,1],[158,13,158,14,1],[158,13,158,14,1],[159,17,159,67,1],[159,17,159,67,1],[159,17,159,67,1],[159,17,159,67,1],[159,17,159,67,1],[160,17,160,63,1],[160,17,160,63,1],[160,17,160,63,1],[160,17,160,63,1],[160,17,160,63,1],[161,13,161,14,1],[161,13,161,14,1],[161,13,161,14,1],[161,13,161,14,1],[161,13,161,14,1],[162,9,162,10,1],[162,9,162,10,1],[162,9,162,10,1],[162,9,162,10,1],[162,9,162,10,1]]);
    </script>
  </body>
</html>